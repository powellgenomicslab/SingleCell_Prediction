---
title: "Compare lasso and elastic net"
author: "Jose Alquicira Hernandez"
date: "15 May 2017"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: cerulean
---

# Data processing

Cardiodiff datasets used:

- **Cluster cell labels**: `my.clusters_0.45_Day2.RDS`
- **Expression data**: `Exprs_DCVLnorm_unlog_minus1_pos_Day2.RDS`
- **Differential expressed genes**: `DEseq_Cluster1_vs_OtherClusters_Day2.txt_filtered_pAdjusted_sorted.txt`

Data fatures:

- **Day**: 2
- **Cluster comparison**: 1 versus other clusters


```{r import_libraries}
library(magrittr)
library(reshape2)
library(ggplot2)
library(ggthemes)
```


```{r read_data}
# Read cluster labels
clusters.path <- file.path('..', 'data', '05-05-2017_quan_data', 'my.clusters_0.45_Day2.RDS')
my.clusters <- readRDS(clusters.path)

# Read prediction results
results.path <- file.path('..','results','18-05-2017_test_prediction','All_List_c1vs_Remaining_Day2_Testing.RDS')
results <- readRDS(results.path)
```

```{r define_function_GetModelAcc}
GetModelAcc <- function(model){
  model.acc <- model %>% 
  lapply("[", 1) %>%
  lapply("[[", 1) %>% 
  lapply("[[", 1) %>% 
  unlist()
  
  model.inacc <- model %>% 
  lapply("[", 1) %>%
  lapply("[[", 1) %>% 
  lapply("[[", 2) %>% 
  unlist()
  
  return(data.frame(accurate = model.acc, inaccurate = model.inacc))
}
```

```{r get_accuracy}
elastic.net.0.1.acc <- GetModelAcc(model = results$elastic.net.0.1)
elastic.net.0.5.acc <- GetModelAcc(model = results$elastic.net.0.5)
elastic.net.0.9.acc <- GetModelAcc(model = results$elastic.net.0.9)
lasso.acc <- GetModelAcc(model = results$lasso)
ridge.acc <- GetModelAcc(model = results$ridge)
```




```{r bind_datasets}
lasso.elastic <- rbind(lasso.acc, elastic.net.0.5.acc, elastic.net.0.1.acc, elastic.net.0.9.acc, ridge.acc)

n.bootstrap <- 50

lasso.elastic$model <- c(rep("lasso", n.bootstrap), 
                         rep("elastic net: 0.5", n.bootstrap), 
                         rep("elastic net: 0.1", n.bootstrap), 
                         rep("elastic net: 0.9", n.bootstrap), 
                         rep("ridge", n.bootstrap))
```


# Accuracy comparison


```{r plot_data, comment=FALSE}
ggplot(lasso.elastic, aes(x = model, y = accurate/(accurate + inaccurate), fill = model)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.2)) +
  ggtitle("Accuracy comparison between Elastic net, Lasso and Ridge", subtitle = "50 bootstrap replicates were performed") +
  xlab("Model") +
  ylab("Accuracy") +
  theme_minimal() +
  scale_color_brewer()
```

```{r plot_density}
ggplot(lasso.elastic, aes(x = accurate/(accurate + inaccurate), fill = model)) +
  geom_density(alpha = 0.5) + 
  ggtitle("Accuracy comparison between Elastic net, Lasso and Ridge", subtitle = "50 bootstrap replicates were performed") +
  ylab("Density") +
  xlab("Accuracy") +
  theme_minimal() +
  scale_color_brewer()
```

```{r}
GetGenes <- function(model){
  model %>% 
    lapply("[[", 2) %>% 
    lapply(function(x) nrow(x) - 1) %>% 
    unlist -> n.genes
  return(n.genes)
}
```



```{r}
elastic.net.0.1.ngenes <- GetGenes(model = results$elastic.net.0.1)
elastic.net.0.5.ngenes <- GetGenes(model = results$elastic.net.0.5)
elastic.net.0.9.ngenes <- GetGenes(model = results$elastic.net.0.9)
lasso.ngenes <- GetGenes(model = results$lasso)
ridge.ngenes <- GetGenes(model = results$ridge)
```

```{r}
models.ngenes <- data.frame(elastic.net.0.1 = elastic.net.0.1.ngenes, elastic.net.0.5 = elastic.net.0.5.ngenes, elastic.net.0.9 = elastic.net.0.9.ngenes, lasso = lasso.ngenes, ridge = ridge.ngenes)
```

```{r}
summary(models.ngenes)
```


```{r}
models.ngenes.long <- melt(models.ngenes, variable.name = "model", value.name = "n.genes")
```


```{r}
ggplot(models.ngenes.long, aes(x = model, y = n.genes, fill = model)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.2)) +
  ggtitle("Number of genes included in Elastic net, Lasso and Ridge models", subtitle = paste("50 bootstrap replicates were performed")) +
  xlab("Model") +
  ylab("Number of included genes") +
  theme_minimal() +
  scale_color_brewer()
```


